trigger:
  branches:
    include:
      - main

pool:
  vmImage: 'ubuntu-latest'

variables:
  location: 'uksouth'
  resourceGroupName: 'rg-vnet-wotlab01'
  vnetTemplateFile: 'LZ-ARM/DeployNetworking/azuredeploy.json'
  vnetParametersFile: 'LZ-ARM/DeployNetworking/azuredeploy.parameters.json'
  vnetName: $(vnetName)


steps:
- task: AzureCLI@2
  inputs:
    azureSubscription: 'azureSP'
    scriptType: bash
    scriptLocation: inlineScript
    inlineScript: |
      az group create --name $(resourceGroupName) --location $(location)

- task: AzureResourceManagerTemplateDeployment@3
  displayName: 'Deploy Hub VNET and Subnets'
  inputs:
    azureResourceManagerConnection: 'azureSP'
    action: 'Create Or Update Resource Group'
    resourceGroupName: $(resourceGroupName)
    subscriptionId: 'd9d2ecd3-56a0-4f15-bae9-04b37c0d4335'
    location: $(location)
    templateLocation: 'Linked artifact'
    csmFile: '$(System.DefaultWorkingDirectory)/$(armTemplateFile)'
    csmParametersFile: '$(System.DefaultWorkingDirectory)/$(armParametersFile)'
    deploymentMode: 'Incremental'